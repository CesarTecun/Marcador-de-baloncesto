<div class="grid gap-4 p-4 max-w-6xl mx-auto">
  <!-- Barra superior: búsqueda / acciones -->
  <section class="flex flex-wrap items-center gap-2">
    <input [(ngModel)]="q" placeholder="Buscar equipos…" class="border rounded px-2 py-1" />
    <button class="px-3 py-1 rounded bg-blue-600 text-white" (click)="reloadAll()">Actualizar</button>
  </section>

  <!-- Sección de Juegos Activos y Programados -->
  <section *ngIf="activeGames.length > 0" class="bg-blue-50 p-4 rounded-lg mb-4">
    <h2 class="text-lg font-semibold mb-3 text-blue-800">
      {{ hasActiveGames() ? 'Juegos Activos' : 'Juegos Programados' }}
    </h2>
    <div class="grid gap-3">
      <div *ngFor="let game of activeGames" 
           class="border rounded p-3 hover:bg-blue-100 cursor-pointer transition-colors"
           (click)="selectGame(game)">
        <div class="flex justify-between items-center">
          <div>
            <div class="font-medium">{{ game.homeTeam }} vs {{ game.awayTeam }}</div>
            <div class="text-sm text-gray-600">
              <span *ngIf="game.status !== 'SCHEDULED'">Q{{ game.quarter }} - </span>{{ game.status }}
              <span *ngIf="game.homeScore !== undefined && game.awayScore !== undefined">
                | {{ game.homeScore }} - {{ game.awayScore }}
              </span>
            </div>
          </div>
          <button 
            class="px-3 py-1 bg-blue-600 text-white rounded text-sm hover:bg-blue-700"
            (click)="$event.stopPropagation(); selectGame(game)">
            {{ game.status === 'SCHEDULED' ? 'Configurar' : 'Administrar' }}
          </button>
        </div>
      </div>
    </div>
  </section>

  <section class="grid gap-4" style="grid-template-columns: 1fr 2fr;">
    <!-- Panel de partidos -->
    <div class="border rounded p-3">
      <h3 class="font-semibold mb-2">Partidos</h3>
      <ul class="divide-y">
        <li *ngFor="let g of games | slice:0:50" class="py-2 flex items-center justify-between">
          <div>
            <a [routerLink]="['/display', g.gameId]" class="font-medium">{{ g.homeTeam }} vs {{ g.awayTeam }}</a>
            <div class="text-xs text-gray-500">Q{{ g.quarter }} — {{ g.status }}</div>
          </div>
          <div class="flex items-center gap-2">
            <button class="text-blue-600" [routerLink]="['/results']" [queryParams]="{ id: g.gameId }">Ver</button>
          </div>
        </li>
      </ul>

      <!-- Crear partido emparejando por IDs -->
      <div class="mt-4 border-t pt-3">
        <div class="font-semibold mb-2">Crear/Emparejar partido</div>
        <div class="flex flex-wrap items-center gap-2">
          <select #homeSel class="border rounded px-2 py-1">
            <option [value]="0">HomeTeamId…</option>
            <option *ngFor="let t of teams" [value]="t.teamId">{{ t.name }}</option>
          </select>
          <select #awaySel class="border rounded px-2 py-1">
            <option [value]="0">AwayTeamId…</option>
            <option *ngFor="let t of teams" [value]="t.teamId">{{ t.name }}</option>
          </select>
          <button
            class="px-3 py-1 rounded bg-green-600 text-white"
            [disabled]="creating"
            (click)="createGame(+homeSel.value, +awaySel.value)">
            {{ creating ? 'Creando…' : 'Crear' }}
          </button>
        </div>
      </div>
    </div>

    <!-- Lista de equipos -->
    <div class="mt-4 border rounded p-3">
      <div class="font-semibold mb-2">Equipos existentes</div>
      <ul class="list-disc pl-5 text-sm">
        <li *ngFor="let t of teams">
          {{ t.name }} <span class="text-gray-500 text-xs">#{{t.teamId}}</span>
        </li>
      </ul>
    </div>

        <!-- Crear equipo -->
    <div class="mt-4 border rounded p-3">
      <div class="font-semibold mb-2">Crear equipo</div>
      <div class="flex flex-wrap items-center gap-2">
        <input [(ngModel)]="newTeamName" placeholder="Nombre del equipo…" class="border rounded px-2 py-1" />
        <button class="px-3 py-1 rounded bg-green-600 text-white"
                [disabled]="creating || !newTeamName.trim()"
                (click)="createTeam()">
          {{ creating ? 'Creando…' : 'Crear equipo' }}
        </button>
      </div>
      <div class="text-xs text-gray-500 mt-1">* El nombre debe ser único.</div>
    </div>

    <!-- Gestión de jugadores por equipo (admin) -->
    <div class="mt-4">
      <app-admin-team-roster></app-admin-team-roster>
    </div>

    <!-- Detalle seleccionado -->
    <div class="border rounded p-3" *ngIf="detail as d">
      <app-scoreboard 
        [game]="d.game" 
        [events]="d.events"
        [isAdmin]="true"
        (adjustScore)="onAdjustScore($event)"
      ></app-scoreboard>

      <div class="mt-3">
        <!-- Game Status Display and Controls -->
        <div class="mb-3 p-3 bg-gray-100 rounded-lg">
          <div class="flex justify-between items-center mb-2">
            <h4 class="font-semibold">Estado del Partido</h4>
            <span 
              class="px-2 py-1 text-xs font-semibold rounded-full"
              [ngClass]="{
                'bg-green-100 text-green-800': d.game.status === 'IN_PROGRESS',
                'bg-red-100 text-red-800': d.game.status === 'FINISHED' || d.game.status === 'CANCELLED',
                'bg-yellow-100 text-yellow-800': d.game.status === 'SUSPENDED',
                'bg-blue-100 text-blue-800': d.game.status === 'SCHEDULED'
              }"
            >
              {{ 
                d.game.status === 'IN_PROGRESS' ? 'EN PROGRESO' :
                d.game.status === 'FINISHED' ? 'FINALIZADO' :
                d.game.status === 'CANCELLED' ? 'CANCELADO' :
                d.game.status === 'SUSPENDED' ? 'SUSPENDIDO' :
                'PROGRAMADO'
              }}
            </span>
          </div>
          <div class="flex flex-wrap gap-2">
            <button 
              *ngIf="d.game.status === 'IN_PROGRESS'" 
              (click)="suspendGame(d.game.gameId)"
              class="px-3 py-1 bg-yellow-600 text-white rounded hover:bg-yellow-700"
            >
              Suspender Partido
            </button>
            
            <button 
              *ngIf="d.game.status === 'SUSPENDED'" 
              (click)="resumeGame(d.game.gameId)"
              class="px-3 py-1 bg-green-600 text-white rounded hover:bg-green-700"
            >
              Reanudar Partido
            </button>
            
            <button 
              *ngIf="d.game.status !== 'FINISHED' && d.game.status !== 'CANCELLED'" 
              (click)="cancelGame(d.game.gameId)"
              class="px-3 py-1 bg-gray-600 text-white rounded hover:bg-gray-700"
            >
              Cancelar Partido
            </button>
          </div>
        </div>

        <div style="display:flex; align-items:flex-start; gap: 1rem;" *ngIf="d.game.status === 'IN_PROGRESS' || d.game.status === 'SUSPENDED' || d.game.status === 'SCHEDULED'">
          <div style="flex: 1;">
            <app-control-panel 
              *ngIf="d.game.status === 'IN_PROGRESS' || d.game.status === 'SUSPENDED' || d.game.status === 'SCHEDULED'"
              [game]="d.game" 
              (changed)="view(d.game.gameId)" 
              [isSuspended]="d.game.status === 'SUSPENDED'">
            </app-control-panel>
            
            <div *ngIf="d.game.status === 'SCHEDULED'" class="mt-2">
              <button 
                (click)="startGame(d.game.gameId)" 
                class="w-full bg-green-600 text-white py-2 px-4 rounded hover:bg-green-700">
                Iniciar Juego
              </button>
            </div>
          </div>
          
          <app-clock
            *ngIf="d.game.status === 'IN_PROGRESS' || d.game.status === 'SUSPENDED'"
            [gameId]="d.game.gameId"
            [status]="d.game.status"
            [quarter]="d.game.quarter"
            [showTeamFouls]="false"
            (expired)="onExpire()"
            (resetGame)="onResetGame()">
          </app-clock>
        </div>
      </div>

      <div class="mt-4" style="display:grid; gap:1rem; grid-template-columns: 1fr 1fr;">
        <app-team-roster [gameId]="d.game.gameId" side="HOME"></app-team-roster>
        <app-team-roster [gameId]="d.game.gameId" side="AWAY"></app-team-roster>
      </div>
    </div>
    
  </section>
</div>

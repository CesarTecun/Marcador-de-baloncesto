<div class="card shadow-sm">
  <div class="card-header">
    <h5 class="card-title mb-0">
      <i class="bi bi-people-fill me-2"></i>
      Gestión de jugadores por equipo
    </h5>
  </div>
  <div class="card-body">

  <select
    class="form-select mb-3"
    [(ngModel)]="selectedTeamId"
    (ngModelChange)="onSelectTeam($event)"
    [ngModelOptions]="{ standalone: true }"
  >
    <option [ngValue]="null">Seleccione equipo…</option>
    <option *ngFor="let t of teams; trackBy: trackTeam" [ngValue]="t.teamId">
      {{ t.name }} (#{{ t.teamId }})
    </option>
  </select>

  <!-- Lista de jugadores -->
  <div *ngIf="selectedTeamId !== null; else noTeam">
    <h6 class="mb-3">Equipo #{{ selectedTeamId }}</h6>

    <div *ngIf="loading" class="text-center my-4">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Cargando...</span>
      </div>
      <p class="mt-2">Cargando jugadores…</p>
    </div>
    
    <div *ngIf="!loading">
      <div class="table-responsive">
        <table class="table table-sm table-hover" *ngIf="players.length > 0">
          <thead>
            <tr>
              <th style="width: 3rem;">#</th>
              <th>Nombre</th>
              <th style="width: 8rem;">Posición</th>
              <th style="width: 7rem;">Estatura</th>
              <th style="width: 6rem;">Edad</th>
              <th style="width: 10rem;">Nacionalidad</th>
              <th style="width: 6rem;">Acciones</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let p of players; trackBy: trackPlayer">
              <td>{{ p.number ?? '—' }}</td>
              <td>{{ p.name }}</td>
              <td>{{ p.position || '-' }}</td>
              <td>{{ p.heightCm ? (p.heightCm + ' cm') : '—' }}</td>
              <td>{{ p.age ?? '—' }}</td>
              <td>{{ p.nationality || '—' }}</td>
              <td>
                <button class="btn btn-sm btn-outline-danger" (click)="deletePlayer(p)">
                  <i class="bi bi-trash"></i> Eliminar
                </button>
              </td>
            </tr>
          </tbody>
        </table>
        <div *ngIf="players.length === 0" class="alert alert-info">
          <i class="bi bi-info-circle me-2"></i>No hay jugadores registrados en este equipo.
        </div>
      </div>
    </div>

    <!-- Formulario para agregar jugador -->
    <div class="card mt-4">
      <div class="card-header">
        <h6 class="mb-0">Agregar nuevo jugador</h6>
      </div>
      <div class="card-body">
        <div class="row g-3">
          <div class="col-md-4">
            <label class="form-label">Nombre</label>
            <input 
              type="text" 
              class="form-control" 
              [(ngModel)]="pName" 
              placeholder="Nombre completo"
              [disabled]="saving"
            >
          </div>
          <div class="col-md-3">
            <label class="form-label">Número (opcional)</label>
            <input 
              type="number" 
              class="form-control" 
              [(ngModel)]="pNumber" 
              placeholder="0-99" 
              min="0" 
              max="99"
              [disabled]="saving"
            >
          </div>
          <div class="col-md-3">
            <label class="form-label">Posición (opcional)</label>
            <input 
              type="text" 
              class="form-control" 
              [(ngModel)]="pPosition" 
              placeholder="Ej: Base, Alero..."
              [disabled]="saving"
            >
          </div>
          <div class="col-md-2">
            <label class="form-label">Estatura (cm)</label>
            <input
              type="number"
              class="form-control"
              [(ngModel)]="pHeightCm"
              placeholder="Ej: 185"
              min="100" max="260"
              [disabled]="saving"
            >
          </div>
          <div class="col-md-2">
            <label class="form-label">Edad</label>
            <input
              type="number"
              class="form-control"
              [(ngModel)]="pAge"
              placeholder="Ej: 22"
              min="8" max="70"
              [disabled]="saving"
            >
          </div>
          <div class="col-md-3">
            <label class="form-label">Nacionalidad</label>
            <input
              type="text"
              class="form-control"
              [(ngModel)]="pNationality"
              placeholder="Ej: Guatemala"
              [disabled]="saving"
            >
          </div>
          <div class="col-md-2 d-flex align-items-end">
            <button 
              class="btn btn-primary w-100" 
              [disabled]="!pName || saving" 
              (click)="createPlayer()"
            >
              <span *ngIf="saving" class="spinner-border spinner-border-sm me-1" role="status" aria-hidden="true"></span>
              {{ saving ? 'Guardando...' : 'Agregar' }}
            </button>
          </div>
        </div>
        
        <div *ngIf="errorMsg" class="alert alert-danger mt-3 mb-0">
          <i class="bi bi-exclamation-triangle me-2"></i>{{ errorMsg }}
        </div>
        
        <div class="form-text mt-2">
          <i class="bi bi-info-circle me-1"></i> El número de jugador debe ser único por equipo cuando se especifica.
        </div>
      </div>
    </div>
  </div>

  <ng-template #noTeam>
    <div class="alert alert-info mb-0">
      <i class="bi bi-info-circle me-2"></i>Por favor, selecciona un equipo para gestionar su plantilla.
    </div>
  </ng-template>
  </div>
</div>

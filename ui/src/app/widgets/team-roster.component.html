<!--
/// <summary>
/// Widget de roster por equipo (lista jugadores y sus datos).
/// </summary>
/// <remarks>
/// - Muestra número, nombre, posición y otros datos del jugador.
/// - Emite interacciones según permisos (solo lectura en público).
/// - Estilos alineados al tema general de la aplicación.
/// </remarks>
-->
<div class="roster-card h-100">
  <div class="roster-header">
    <h6 class="mb-0">
      <i class="bi bi-people-fill me-2"></i>
      {{ side === 'HOME' ? 'Local' : 'Visitante' }}
    </h6>
    <span class="badge">{{ players.length }} jugadores</span>
  </div>
  
  <div class="roster-body">
    <!-- Errores para edición inline (cuando no está el formulario de alta) -->
    <div *ngIf="!showAddPlayerForm && error" class="alert alert-danger py-2 mx-3 mt-3">
      <small>{{ error }}</small>
    </div>
    <!-- Formulario para agregar jugador -->
    <div *ngIf="showAddPlayerForm" class="p-3 border-bottom">
      <h6 class="mb-3">Agregar nuevo jugador</h6>
      
      <div *ngIf="error" class="alert alert-danger py-2">
        <small>{{ error }}</small>
      </div>
      
      <form (ngSubmit)="addPlayer()" #playerForm="ngForm">
        <div class="mb-2">
          <label class="form-label small mb-1">Nombre</label>
          <input type="text" class="form-control form-control-sm" 
                 [(ngModel)]="newPlayer.name" 
                 name="playerName" 
                 required
                 [disabled]="!canEdit || isLoading">
        </div>
        
        <div class="row g-2 mb-2">
          <div class="col-6">
            <label class="form-label small mb-1">Número</label>
            <input type="number" class="form-control form-control-sm" 
                   [(ngModel)]="newPlayer.number" 
                   name="playerNumber"
                   min="0"
                   max="99"
                   [disabled]="!canEdit || isLoading">
          </div>
          <div class="col-6">
            <label class="form-label small mb-1">Posición</label>
            <input type="text" class="form-control form-control-sm" 
                   [(ngModel)]="newPlayer.position" 
                   name="playerPosition"
                   [disabled]="!canEdit || isLoading">
          </div>
        </div>

        <div class="row g-2 mb-3">
          <div class="col-4">
            <label class="form-label small mb-1">Estatura (cm)</label>
            <input type="number" class="form-control form-control-sm"
                   [(ngModel)]="newPlayer.heightCm"
                   name="playerHeightCm"
                   min="100" max="260"
                   placeholder="Ej: 185"
                   [disabled]="!canEdit || isLoading">
          </div>
          <div class="col-4">
            <label class="form-label small mb-1">Edad</label>
            <input type="number" class="form-control form-control-sm"
                   [(ngModel)]="newPlayer.age"
                   name="playerAge"
                   min="8" max="70"
                   placeholder="Ej: 22"
                   [disabled]="!canEdit || isLoading">
          </div>
          <div class="col-4">
            <label class="form-label small mb-1">Nacionalidad</label>
            <input type="text" class="form-control form-control-sm"
                   [(ngModel)]="newPlayer.nationality"
                   name="playerNationality"
                   placeholder="Ej: Guatemala"
                   [disabled]="!canEdit || isLoading">
          </div>
        </div>
        
        <div class="d-flex gap-2">
          <button type="submit" class="btn btn-primary btn-sm flex-grow-1" [disabled]="!canEdit || isLoading">
            <span *ngIf="!isLoading">Guardar</span>
            <span *ngIf="isLoading" class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
          </button>
          <button type="button" class="btn btn-outline-secondary btn-sm" 
                  (click)="toggleAddPlayerForm()"
                  [disabled]="!canEdit || isLoading">
            Cancelar
          </button>
        </div>
      </form>
    </div>
    
    <!-- Lista de jugadores -->
    <div *ngIf="players.length > 0; else empty" class="list-group list-group-flush">
      <div *ngFor="let p of players" class="list-group-item py-2">
        <div class="d-flex align-items-center w-100">
          <!-- Número (badge o input si edita) -->
          <ng-container *ngIf="editingPlayerId !== p.playerId; else editNumber">
            <span class="badge bg-secondary me-2">#{{ p.number || '—' }}</span>
          </ng-container>
          <ng-template #editNumber>
            <input type="number"
                   class="form-control form-control-sm me-2"
                   style="width: 72px;"
                   [(ngModel)]="editModel.number"
                   [disabled]="!canEdit || isLoading"
                   min="0" max="99">
          </ng-template>

          <!-- Datos de jugador -->
          <div class="flex-grow-1">
            <ng-container *ngIf="editingPlayerId !== p.playerId; else editFields">
              <div class="fw-medium">{{ p.name || 'Sin nombre' }}</div>
              <small *ngIf="p.position" class="text-muted d-block">{{ p.position }}</small>
              <small class="text-muted" *ngIf="p.heightCm || p.age || p.nationality">
                <span *ngIf="p.heightCm">Altura: {{ p.heightCm }} cm</span>
                <span *ngIf="p.age"> • Edad: {{ p.age }}</span>
                <span *ngIf="p.nationality"> • {{ p.nationality }}</span>
              </small>
            </ng-container>
            <ng-template #editFields>
              <div class="row g-2">
                <div class="col-sm-6">
                  <input type="text"
                         class="form-control form-control-sm"
                         [(ngModel)]="editModel.name"
                         [disabled]="!canEdit || isLoading"
                         placeholder="Nombre">
                </div>
                <div class="col-sm-6">
                  <input type="text"
                         class="form-control form-control-sm"
                         [(ngModel)]="editModel.position"
                         [disabled]="!canEdit || isLoading"
                         placeholder="Posición">
                </div>
                <div class="col-4">
                  <input type="number"
                         class="form-control form-control-sm"
                         [(ngModel)]="editModel.heightCm"
                         [disabled]="!canEdit || isLoading"
                         placeholder="Estatura (cm)"
                         min="100" max="260">
                </div>
                <div class="col-4">
                  <input type="number"
                         class="form-control form-control-sm"
                         [(ngModel)]="editModel.age"
                         [disabled]="!canEdit || isLoading"
                         placeholder="Edad"
                         min="8" max="70">
                </div>
                <div class="col-4">
                  <input type="text"
                         class="form-control form-control-sm"
                         [(ngModel)]="editModel.nationality"
                         [disabled]="!canEdit || isLoading"
                         placeholder="Nacionalidad">
                </div>
              </div>
            </ng-template>
          </div>

          <!-- Acciones -->
          <div class="ms-2 d-flex gap-1">
            <!-- Editar -->
            <button *ngIf="editingPlayerId !== p.playerId"
                    class="btn btn-sm btn-outline-secondary"
                    [disabled]="!canEdit || isLoading"
                    (click)="startEdit(p)">
              <i class="bi bi-pencil-square me-1"></i>
              Editar
            </button>

            <!-- Guardar / Cancelar -->
            <ng-container *ngIf="editingPlayerId === p.playerId">
              <button class="btn btn-sm btn-success"
                      [disabled]="!canEdit || isLoading"
                      (click)="saveEdit(p)">
                <i class="bi bi-check2 me-1"></i>
                Guardar
              </button>
              <button class="btn btn-sm btn-outline-secondary"
                      [disabled]="!canEdit || isLoading"
                      (click)="cancelEdit()">
                <i class="bi bi-x-lg me-1"></i>
                Cancelar
              </button>
            </ng-container>

            <!-- Eliminar -->
            <button class="btn btn-sm btn-outline-danger"
                    [disabled]="!canEdit || isLoading || editingPlayerId === p.playerId"
                    (click)="deletePlayer(p)">
              <i class="bi bi-trash me-1"></i>
              Eliminar
            </button>
          </div>
        </div>
      </div>
    </div>
    
    <ng-template #empty>
      <div class="text-center p-4">
        <i class="bi bi-people-slash d-block text-muted mb-2" style="font-size: 2rem;"></i>
        <p class="text-muted mb-0">No hay jugadores registrados</p>
      </div>
    </ng-template>
  </div>
  
  <div class="roster-footer text-center" *ngIf="!showAddPlayerForm">
    <button class="btn btn-primary btn-sm w-100" (click)="toggleAddPlayerForm()" [disabled]="!canEdit">
      <i class="bi bi-plus-circle me-1"></i>Agregar Jugador
    </button>
  </div>
</div>
